<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hello World</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
    }

    .container {
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 3rem 4rem;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      width: 100%;
      max-width: 350px;
    }

    h1 {
      font-size: 2.2rem;
      margin: 0;
    }

    p {
      margin-top: 1rem;
      font-size: 1.1rem;
      opacity: 0.85;
    }

    button {
      margin-top: 2rem;
      padding: 0.8rem 2rem;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      background: #fff;
      color: #764ba2;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    button:hover {
      background: #764ba2;
      color: #fff;
    }

    @media (max-width: 600px) {
      .container {
        padding: 2rem 1rem;
        max-width: 95vw;
      }
      h1 {
        font-size: 1.5rem;
      }
      button {
        font-size: 1rem;
        padding: 0.7rem 1.2rem;
      }
      p {
        font-size: 1rem;
      }
    }
  </style>
  <!-- MetaMask SDK via CDN -->
  <script src="https://unpkg.com/@metamask/sdk/dist/metamask-sdk.umd.js"></script>
</head>
<body>
  <div class="container" id="login-menu">
    <h1>Login</h1>
    <button id="connect-btn">Connect MetaMask</button>
    <p id="login-status"></p>
  </div>
  <div class="container" id="main-menu" style="display: none;">
    <h1>Hello, World üåç</h1>
    <p>Welcome to your first modern web page.</p>
    <input type="number" id="matic-amount" min="0" step="0.0001" placeholder="Amount of MATIC" style="margin-top:1.5rem; padding:0.5rem; border-radius:6px; border:1px solid #ccc; width: 80%;">
    <button id="send-matic-btn">Send MATIC</button>
    <button id="logout-btn">Logout</button>
    <p id="wallet-balance" style="margin-top:1rem;"></p>
    <p id="wallet-address"></p>
    <p id="send-matic-status"></p>
  </div>

   <script>

document.addEventListener('DOMContentLoaded', function() {
  const sendBtn = document.getElementById('send-matic-btn');
  const amountInput = document.getElementById('matic-amount');
  const statusP = document.getElementById('send-matic-status');

  if (sendBtn) {
    sendBtn.onclick = async function() {
      statusP.textContent = '';
      const amount = parseFloat(amountInput.value);
      if (isNaN(amount) || amount <= 0) {
        statusP.textContent = "Please enter a valid amount of MATIC to send.";
        return;
      }
      statusP.textContent = "Sending transaction...";
      const success = await sendMATIC(amount);
      if (success) {
        statusP.textContent = "‚úÖ Transaction sent!";
      } else {
        statusP.textContent = "‚ùå Transaction failed or cancelled.";
      }
    };
  }
});

// Default structure for savedGameData
let savedGameData = {
    player: {
      wallet: null,
      username: null,
      // Add more fields as needed (e.g., highScore, settings, etc.)
    }
  };

  // Load from localStorage if available
  function loadAllData() {
    const data = localStorage.getItem('savedGameData');
    if (data) {
      try {
        savedGameData = JSON.parse(data);
      } catch (e) {
        // If corrupted, reset to default
        savedGameData = {
          player: { wallet: null, username: null }
        };
      }
    }
  }

  // Save to localStorage
  function saveAllData() {
    localStorage.setItem('savedGameData', JSON.stringify(savedGameData));
  }

  // Call this on page load
  loadAllData();

async function updateWalletBalance() {
  if (!window.ethereum || !savedGameData.player.wallet) {
    document.getElementById('wallet-balance').textContent = '';
    return;
  }
  try {
    // Get balance in wei
    const balanceWei = await window.ethereum.request({
      method: 'eth_getBalance',
      params: [savedGameData.player.wallet, 'latest']
    });
    // Convert from hex wei to decimal MATIC
    const balanceMatic = parseFloat(parseInt(balanceWei, 16) / 1e18).toFixed(4);
    document.getElementById('wallet-balance').textContent = `Balance: ${balanceMatic} MATIC`;
  } catch (err) {
    document.getElementById('wallet-balance').textContent = 'Balance: Error';
  }
}

  
   async function connectWallet() {
       if (typeof window.ethereum === 'undefined') {
           showRewardNotification("‚ùå MetaMask is not installed. Please install MetaMask to connect your wallet.");
           return;
       }
       try {
           const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
           const account = accounts[0];

           // Check network
           const chainId = await window.ethereum.request({ method: 'eth_chainId' });
           if (chainId !== '0x89') {
               try {
                   await window.ethereum.request({
                       method: 'wallet_switchEthereumChain',
                       params: [{ chainId: '0x89' }]
                   });
                   showRewardNotification("‚úÖ Switched to Polygon network!");
               } catch (switchError) {
                   showRewardNotification("‚ùå Please switch to Polygon network in MetaMask.");
                   return;
               }
           }

           savedGameData.player.wallet = account;
           saveAllData();
           await updateWalletBalance();
           document.getElementById('walletMenu').style.display = 'none';
           if (!savedGameData.player.username) {
               document.getElementById('usernameMenu').style.display = 'block';
               document.getElementById('usernameInput').value = '';
               document.getElementById('usernameError').textContent = '';
           } else {
               goHome();
           }
       } catch (err) {
           showRewardNotification("‚ùå Wallet connection failed: " + (err.message || err));
       }
   }
    </script>

    <script>
    function submitUsername() {
        const input = document.getElementById('usernameInput');
        const errorDiv = document.getElementById('usernameError');
        let username = input.value.trim();

        // Basic validation
        if (username.length < 3) {
            errorDiv.textContent = "Username must be at least 3 characters.";
            return;
        }
        if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            errorDiv.textContent = "Only letters, numbers, and underscores allowed.";
            return;
        }

        // Save and continue
        savedGameData.player.username = username;
        saveAllData();
        document.getElementById('usernameMenu').style.display = 'none';
        goHome();
    }
    </script>

    <script>
    window.addEventListener('DOMContentLoaded', async function() {
        if (window.ethereum && savedGameData.player.wallet) {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0 && accounts[0] === savedGameData.player.wallet) {
                    // Wallet is still connected
                    updateHomeScreen();
                } else {
                    // Wallet is not connected anymore
                    // Optionally, clear savedGameData.player.wallet here
                }
            } catch (e) {
                // Handle error if needed
            }
        }
    });
    </script>

    <script>
    function buyPLAI() {
        // Replace the URL below with your actual buy link if you have one
        window.open('https://matcha.xyz/tokens/base/0x977ea2dda60c1fdffd4b0377b036d3871f2d01a9', '_blank');
    }
    </script>

    <script>
    window.addEventListener('DOMContentLoaded', function() {
        if (savedGameData.player.wallet) {
            updateWalletBalance();
        }
    });
    </script>

    <script>
    function disconnectWallet() {
        // Remove wallet from saved data
        if (savedGameData.player.wallet) {
            delete savedGameData.player.wallet;
            saveAllData();
        }
        // Optionally, show the wallet connect menu again
        hideAllMenus();
        document.getElementById('walletMenu').style.display = 'block';
        // Optionally, update UI to reflect disconnected state
        updateHomeScreen();
        showRewardNotification && showRewardNotification("üîå Wallet disconnected.");
    }
    </script>

    <script>
    async function sendMATIC(amount) {
    if (!window.ethereum || !savedGameData.player.wallet) {
        showRewardNotification("‚ùå Connect your wallet first.");
        return false;
    }
    try {
        // Ensure on Polygon
        await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: '0x89' }]
        });
    } catch (switchError) {
        showRewardNotification("‚ùå Please switch to Polygon network in MetaMask.");
        return false;
    }
    try {
        const value = (amount * 1e18).toString(16); // amount in wei, hex
        const tx = await window.ethereum.request({
            method: 'eth_sendTransaction',
            params: [{
                from: savedGameData.player.wallet,
                to: "0x455e53cbb86018ac2b8092fdcd39d8444affc3f6", // <-- your provided address
                value: value
            }]
        });
        showRewardNotification("‚úÖ MATIC sent! <a href='https://polygonscan.com/tx/" + tx + "' target='_blank'>View on PolygonScan</a>");
        return true;
    } catch (err) {
        if (err.code === 4001) {
            showRewardNotification("‚ùå Transaction rejected by user.");
        } else {
            showRewardNotification("‚ùå Payment failed: " + (err.message || err));
        }
        return false;
    }
}


    </script>

    <script>
    if (window.ethereum) {
        window.ethereum.on('chainChanged', (chainId) => {
            if (chainId !== '0x89') {
                showRewardNotification("‚ö†Ô∏è Please switch to Polygon network to play!");
            }
        });
    }
  </script>
</body>
</html>
